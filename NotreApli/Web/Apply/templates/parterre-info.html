{% extends "header.html" %}
{% block head %}
{{ super() }}
<link rel="stylesheet" href="https://openlayers.org/en/v4.5.0/css/ol.css" type="text/css">
<!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
<script src="https://openlayers.org/en/v4.5.0/build/ol.js"></script>
{% endblock %}
{% block main %}
<h1>{{ parterre.get_name() }}</h1>

<div class = "fleurs">
  <p> liste des fleurs </p>
  <ul>
  {% for plante in parterre.get_plantes() %}
    <li>{{ plante.get_name() }}</li>
  {% endfor %}
  </ul>
</div>

<div class = "capteurs">
  <p> liste des capteurs </p>
  <ul>
  {% for capteur in parterre.get_capteurs() %}
    <li>{{ capteur.get_name() }}</li>
  {% endfor %}
  </ul>
</div>
<div id="map" class="col-md-8 map"></div>
{% if parterre.get_name()!= "Bac Ã  sable" %}
<div>
    <a href = "{{ url_for('delete_parterre', id = parterre.get_id()) }}">
      <input class = "btn btn-danger" type = "submit" value = "Supprimer">
    </a>
    <a href = "{{ url_for('edit_parterre', id = parterre.get_id()) }}">
      <input class = "btn btn-danger" type = "submit" value = "Modifier">
    </a>
</div>
{% endif %}

{% endblock %}
{% block scripts %}
{{super()}}
<script>
      let raster = new ol.layer.Tile({
        source: new ol.source.OSM()
      });


            let geojsonObject = {
              'type': 'FeatureCollection',
              'crs': {
                'type': 'name',
                'properties': {
                  'name': 'EPSG:3857'
                }
              },
              'features': [{
                'type': 'Feature',
                'geometry': {
                  'type': 'Polygon',
                  'coordinates': [[
                    {% for coord in parterre.coordonnees %}
                      [ {{ coord.latitude}}, {{coord.longitude}}],
                    {% endfor %}
                  ]]
                },
              },
              ]
            };


      let source = new ol.source.Vector({wrapX: false, features: (new ol.format.GeoJSON()).readFeatures(geojsonObject)});

      let vector = new ol.layer.Vector({
        source: source
      });
      let map = new ol.Map({
        layers: [raster, vector],
        target: 'map',
        view: new ol.View({
          center: [214408, 6080900],
          zoom: 15
        })
      });

    </script>
{% endblock %}
